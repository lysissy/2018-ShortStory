# 登录页面流程细节

登录页面是各类网站必备的页面，本文列举了页面里的一些细节的部分，顺便把踩过的坑也整理一下：

### 基本功能：
    - 输入手机号码
    - 动态验证码（有效时间60s）

### 外部文件：
    - jQuery库
    - jQuery Validation Plugin  [表单验证插件](http://jqueryvalidation.org/)
       
## 页面细节：

#### **关于input按钮的文字占位符**
可用placeholder伪元素就ok啦。特别注意的是,因为浏览器兼容性不一致，选择器不要用逗号分隔符打包写在一起，否则你把浏览器都刷爆了，样式一点都没生效，开始怀疑人生～

#### **关于填写纯数字的input类型**
因为移动端设备有软键盘的存在，所以为了优化用户的体验，最好选择[type=tel]的类型，还有一种[type=number]的类型也可以输入纯数字，但是两者在表现上还是有细微差异的，比如小数点。选什么用，看具体的业务需求。然鹅，最不建议使用的就是[type=text]了，平时写的时候用顺手了，电脑上写的时候没觉得什么，真机上测试的时候，键盘的差异还是特别大的，细节上的体验很重要！平时要多积累使用经验。

#### **验证码**
当点击验证码按钮时，来看看发送验证码的流程吧：
1. 检查按钮有效性（当验证码正在发送中，或发送成功且还在时效期内时，点击按钮是无效的，不会做任何操作）。
   我给这个标签元素加了自定义属性值data-disable，值为true代表了不可点击，每次点击的时候拿这个自定义属性的值来判断；
   也可以在代码部分设置一个变量来保存和判断这个值。
2. 检查手机号码有效性。
   手机号码传送到后台，也可以检查手机号码的有效性，只不过一方面加长了用户的等待时间，一方面产生了不必要的请求资源浪费，得不偿失。
3. 接下来就是发送ajax请求了.
   在发送请求前一步，按钮置灰，data-disable属性设置为true，防止用户多次点击重复请求，标示文本"发送中"，这都是优化用户体验的细节。
4. ajax请求失败。常见的由于网络状态等原因，导致请求失败，这时需要按钮恢复可点击的状态，data-disable的属性值别忘记设置。
5. ajax请求成功。按钮倒计时，此期间data-disable仍然是true，直到倒计时结束，按钮恢复可点击状态，颜色、属性和文本信息及时更新。


## 踩坑部分：

#### 1. 验证码点击之后，按钮置灰，一直处于"发送中"的状态，且部分用户反馈正常、部分用户反馈异常。

##### 处理过程：
页面报错：初步判断返回的数据类型不是约好的JSON类型，所以使用JSON解析的地方页面报错了。
查看请求返回数据，果然是"text/html"格式的。后端反馈是服务器不太稳定，在偶然的情况下，会返回了非常规数据。

##### 处理方法：
在这种情况下，ajax依然执行了success函数，只能依靠数据类型的判断来分辨这种网络异常的状态。
我在一接收到请求数据的时候，立即做了类型判断：$.type(data) === "object" 。
在数据正常的情况下执行后续操作，否则抛出数据异常的提示，按钮的状态也需要做相应的调整。

##### 总结：
<del>在本地环境和测试环境下基本没有出现过问题，在生产环境不定时地会重现，现在还不太清楚返回text/html的数据是哪里出现了问题。
对于前台页面来说，做一下容错处理，不能让用户来承担这种风险。</del>
可以确定非前端代码bug的情况下，应该迅速处理线上bug，做容错处理。
    
    
## 可有可无的东西：

0. 登录or登陆：

拼音输入法打出'denglu'，会有`登录`or`登陆`两个词组，即使不知道应该用哪个，也应该保持整站是统一的文字。<br/>
目前大部分的网站需要输入注册用户的登录信息，这样'登录'才是正确的用法。[登入界面中，「登录」和「登陆」哪个正确？](https://www.zhihu.com/question/19570377)

1. 弹窗美化：

因为做移动端页面，对弹窗的美观性还是比较介意，选用了常用的移动端弹窗插件：layer mobile 地址：http://layer.layui.com/mobile
2. 用户注册or登录协议

有些页面会要求同意协议之后才可提交操作，我采用事件监听的方式。
首先封装一个函数checkValid，返回操作按钮有效性的判断结果，Boolean值。
每次执行相关操作时，如点击"同意协议" 或 填写表单的时候，最后都执行下这个函数，根据结果来调整按钮显示的样式。    
        
#### 参考资料：
1. [翻译 - 使用CSS修改HTML5 input placeholder颜色 - SegmentFault 思否](https://segmentfault.com/q/1010000000397925)